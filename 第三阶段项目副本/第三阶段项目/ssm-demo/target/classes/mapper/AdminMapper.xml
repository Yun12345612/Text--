<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cykj.mapper.AdminMapper">
    <!--4.注册新管理员-->
    <insert id="insertAdmin" parameterType="com.cykj.pojo.CyAdmin">
        insert into cy_admin (
            admin_name,
            admin_account,
            admin_pwd,
            salt,
            admin_role_id,
            admin_create_time  -- 创建时间字段
        ) values (
                     #{adminName},
                     #{adminAccount},
                     #{adminPwd},
                     #{salt},
                     #{adminRoleId},
                     now()  -- 使用数据库当前时间
                 )
    </insert>
    <!--3.更新管理员状态-->
    <update id="updateAdminStatus">

        update cy_admin
        set admin_is_delete = 1
        where admin_id in
        <foreach collection="ids" item="id" open="(" close=")" separator=",">
            #{id}
        </foreach>

    </update>
    <!--1.登录加密-->
    
<!--    <resultMap id="adminMap" type="com.cykj.pojo.CyAdmin">-->
<!--        <result property="adminId" column="admin_id"/>-->
<!--        <result property="adminAccount" column="admin_account"/>-->
<!--        <result property="adminName" column="admin_name"/>-->
<!--    </resultMap>-->
    <select id="getAdminByAccount" resultType="com.cykj.pojo.CyAdmin">
        select admin_id      as adminId,
               admin_name    as adminName,
               admin_account as adminAccount,
               admin_pwd     as adminPwd,
               salt          as salt
        from cy_admin
        where admin_account = #{acc}

    </select>
    <!--2.权限查询-->
    <select id="selectRoleByAdminId" resultType="com.cykj.pojo.CyRole">
        select
        r.role_id as roleId,        <!-- 对应 CyRole 的 roleId -->
        r.role_name as roleName     <!-- 对应 CyRole 的 roleName -->
        from cy_role r
        inner join cy_admin a
        on r.role_id = a.admin_role_id  <!-- 通过 admin_role_id 关联角色 -->
        where a.admin_id = #{adminId}
    </select>


</mapper>